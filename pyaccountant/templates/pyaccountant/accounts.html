{% extends 'pyaccountant/base.html' %}
{% load i18n %}

{% block content_header %}
<h1>Accounts
  <small>All accounts</small>
</h1>
<ol class="breadcrumb">
  <li><a href="/">Home</a></li>
  <li class="active">Accounts</li>
</ol>
{% endblock %}

{% block content %}
<div class="box">
  <div class="box-body">
  <canvas id="myChart" width="400" height="200"></canvas>
</div>
</div>
<div class="box">
  <div class="box-header with-border">
    <h3 class="box-title">{% trans 'Accounts' %}</h3>
  </div>
  <div class="box-body no-padding">
    <table class="table table-striped">
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Balance</th>
        <th>Currency</th>
        <th>Active</th>
      </tr>
      {% for account in accounts %}
      <tr>
        <td><a href="{% url 'account_transactions' account.id %}">{{ account.name }}</a></td>
        <td>{{ account.account_type }}</td>
        <td>{{ account.balance }}</td>
        <td>{{ account.currency }}</td>
        <td>{{ account.active }}</td>
      </tr>
      {% endfor %}
    </table>
  </div>
</div>
{% endblock %}


{% block scripts %}
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.6.0/Chart.bundle.min.js"></script>
<script type="text/javascript">
var ctx = document.getElementById("myChart").getContext('2d');
colors = ['red', 'blue', 'orange']
var myChart = new Chart(ctx, {
    type: 'line',
    data: {
        labels:
        [
        {% for label, value in accounts.0.get_data_points %}
        "{{ label }}",
        {% endfor %}
        ],
        datasets: [
        {% for account in accounts %}
        {
            label: '{{ account.name }}',
            fill: false,
            pointRadius: 2,
            backgroundColor: colors[{{ forloop.counter }} - 1],
            borderColor: colors[{{ forloop.counter }} - 1],
            data: [
            {% for label, value in account.get_data_points %}
            {{ value }},
            {% endfor %}
            ],
        },
        {% endfor %}
        ]
    },
    options: {
        scales: {
            yAxes: [{
                ticks: {
                    beginAtZero:true
                }
            }]
        },
        tooltips: {
            mode: 'x'
        }
    }
});
</script>
{% endblock %}